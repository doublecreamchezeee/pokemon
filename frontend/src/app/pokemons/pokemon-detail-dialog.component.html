<div class="dialog-container">
  <ng-container *ngIf="pokemon$ | async as pokemon; else loading">
    <div class="pokemon-header">
      <h2>{{ pokemon.name }}</h2>
      <span class="pokemon-id">#{{ pokemon.id.toString().padStart(3, '0') }}</span>
      <span class="generation-badge">Gen {{ pokemon.generation }}</span>
      <span class="legendary-badge" *ngIf="pokemon.legendary">Legendary</span>
    </div>

    <div class="pokemon-types">
      <span 
        class="type-badge"
        [attr.data-type]="pokemon.type1.toLowerCase()">
        {{ pokemon.type1 }}
      </span>
      <span 
        *ngIf="pokemon.type2"
        class="type-badge"
        [attr.data-type]="pokemon.type2.toLowerCase()">
        {{ pokemon.type2 }}
      </span>
    </div>

    <div *ngIf="pokemon.ytUrl" class="video-container">
      <h3>Video Preview</h3>
      <div class="youtube-embed">
        <iframe 
          [src]="pokemon.ytUrl | safeUrl" 
          frameborder="0" 
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
          allowfullscreen>
        </iframe>
      </div>
    </div>

    <div class="stats-container">
      <h3>Base Stats</h3>
      <div class="stat-row">
        <span class="stat-label">HP</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.hp / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.hp }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Attack</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.attack / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.attack }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Defense</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.defense / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.defense }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Sp. Atk</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.spAtk / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.spAtk }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Sp. Def</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.spDef / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.spDef }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Speed</span>
        <div class="stat-bar-container">
          <div class="stat-bar" [style.width.%]="(pokemon.speed / 255) * 100"></div>
          <span class="stat-value">{{ pokemon.speed }}</span>
        </div>
      </div>
      <div class="stat-row">
        <span class="stat-label">Total</span>
        <div class="stat-bar-container">
          <div class="stat-bar total" [style.width.%]="(pokemon.total / 720) * 100"></div>
          <span class="stat-value">{{ pokemon.total }}</span>
        </div>
      </div>
    </div>

    <div class="dialog-actions">
      <button mat-button (click)="close()">Close</button>
    </div>
  </ng-container>

  <ng-template #loading>
    <div class="loading-container">
      <mat-spinner diameter="48"></mat-spinner>
      <p>Loading Pok√©mon details...</p>
    </div>
  </ng-template>
</div>
